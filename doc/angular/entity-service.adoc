:includedir: ../..
:relrootdir: ../..
= Entity Service

An entity service gives access to the resources from the backend for this entity.
The service provides type safe CRUD operations based on REST or GraphQL with JSON payloads. 

== Architecture overview

The entity service consists of the following building blocks:

**HTTP Client**::
Angular's `HttpClient` for REST and GraphQL API calls.

**Error handling**::
Handling both network and API errors and always returning an `ErrorItem` with RFC 7807 problem details.

**Basic logging**::
Logging requests and responses for debugging.

== Implementation details

Each CRUD operation follows a consistent pattern of path construction followed by a generic HTTP method call.

=== `GET` collection operation

The generic `restApiGetAll` method retrieves a filtered list of entities:

[source,ts]
----
include::{includedir}/app/client-angular/src/main/angular/services/backend.service.ts[tags=restApiGetAll,indent=0]
----

- Accepts search parameters as a `Record<string, string>`

- Converts parameters to `HttpParams` for URL query string

- Extracts `content` array from paginated response

=== `GET` entity operation

The generic `restApiGet` method retrieves a specific entity by ID:

[source,ts]
----
include::{includedir}/app/client-angular/src/main/angular/services/backend.service.ts[tags=restApiGet,indent=0]
----

- Constructs path with entity ID

- Extracts `content` from response

=== `POST` entity operation

The generic `restApiPost` method creates a new entity:

[source,ts]
----
include::{includedir}/app/client-angular/src/main/angular/services/backend.service.ts[tags=restApiPost,indent=0]
----

- Sends entity as JSON in request body

- Extracts `content` from response

=== `PUT` entity operation

The generic `restApiPut` method replaces an entire entity:

[source,ts]
----
include::{includedir}/app/client-angular/src/main/angular/services/backend.service.ts[tags=restApiPut,indent=0]
----

- Sends entity as JSON in request body

- Extracts `content` from response

=== `PATCH` entity operation

The generic `restApiPatch` method updates specific properties of an entity:

[source,ts]
----
include::{includedir}/app/client-angular/src/main/angular/services/backend.service.ts[tags=restApiPatch,indent=0]
----

- Sends entity as JSON in request body

- Uses `application/merge-patch+json` for RFC 7396 compliance

- Extracts `content` from response

=== `DELETE` entity operation

The generic `restApiDelete` method deletes an entity:

[source,typescript]
----
include::{includedir}/app/client-angular/src/main/angular/services/backend.service.ts[tags=restApiDelete,indent=0]
----

- Constructs path with entity ID

- Extracts `content` from response
