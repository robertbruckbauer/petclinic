:includedir: ../..
:relrootdir: ../..
:restdocdir: {includedir}/lib/backend-data/build/generated-snippets
= Visit REST API

REST-API for managing veterinary visits in the pet clinic application.
It provides standard CRUD operations, partial updates via PATCH, and advanced query capabilities for filtering visits by date, pet, veterinarian, and text content.

== Model

=== Visit

Each visit represents a veterinary treatment with a date, time, associated pet, attending veterinarian, and text.
The treatment `date` is required.
The treatment `time` is optional because it only becomes definitive once treatment begins.
the visit is created.
The diagnosis `text` is optional because it is only written at the end of the treatment.
The `pet` relation is optional because visits can be created as placeholders for veterinarians on duty.
The `vet` relation is optional because the veterinarian on duty is not always known at the time the visit is created.

The liquibase script defines the database table.

.Liquibase
[source,xml,options="nowrap"]
----
include::{includedir}/lib/backend-data/src/main/resources/liquibase/v1/visit.xml[]
----

The entity class extends `JsonJpaEntity` which provides unique identifier and version for optimistic locking.

.Entity
[source,java,options="nowrap"]
----
include::{includedir}/lib/backend-api/src/main/java/esy/api/clinic/Visit.java[indent=0,tags=properties]
----

No simplified representation of a _Visit_ exists.

== Operations

=== `POST /api/visit`

This operation creates a new _Visit_ entity.

****

.Command
include::{restdocdir}/post-api-visit/curl-request.adoc[]

.Request
include::{restdocdir}/post-api-visit/http-request.adoc[]

.Response
include::{restdocdir}/post-api-visit/response-body.adoc[]

****

This operation reports `Created` or code 201 if the entity was successfully created.

This operation reports `Bad Request` or code 400 if the data was not processed.

This operation reports `Conflict` or code 409 if a unique constraint would be violated.

=== `PUT /api/visit/{id}`

This operation updates an existing _Visit_ entity or creates a new one.

****

.Command
include::{restdocdir}/put-api-visit/curl-request.adoc[]

.Request
include::{restdocdir}/put-api-visit/http-request.adoc[]

.Response
include::{restdocdir}/put-api-visit/response-body.adoc[]

****

This operation reports `Ok` or code 200 if the entity was successfully updated.

This operation reports `Created` or code 201 if the entity was successfully created.

This operation reports `Bad Request` or code 400 if the data was not processed.

This operation reports `Conflict` or code 409 if a unique constraint would be violated or if data is outdated (invalid ETag).

=== `PATCH /api/visit/{id}`

This operation partially updates an existing _Visit_ entity.
You can update individual properties without affecting other properties.

==== `date` attribute

****

.Command
include::{restdocdir}/patch-api-visit-date/curl-request.adoc[]

.Request
include::{restdocdir}/patch-api-visit-date/http-request.adoc[]

.Response
include::{restdocdir}/patch-api-visit-date/response-body.adoc[]

****

This operation reports `Ok` or code 200 if the entity was successfully updated.

This operation reports `Not Found` or code 404 if the entity does not exist.

This operation reports `Bad Request` or code 400 if the data was not processed.

This operation reports `Conflict` or code 409 if a unique constraint would be violated or if data is outdated (invalid ETag).

TIP: The descriptions of attributes other than date are omitted for simplicity because they are following the same pattern.

==== `pet` relation

****

.Command
include::{restdocdir}/patch-api-visit-pet/curl-request.adoc[]

.Request
include::{restdocdir}/patch-api-visit-pet/http-request.adoc[]

.Response
include::{restdocdir}/patch-api-visit-pet/response-body.adoc[]

****

This operation reports `Ok` or code 200 if the entity was successfully updated.

This operation reports `Not Found` or code 404 if the entity does not exist.

This operation reports `Bad Request` or code 400 if the data was not processed.

This operation reports `Conflict` or code 409 if a unique constraint would be violated or if data is outdated (invalid ETag).

==== `vet` relation

****

.Command
include::{restdocdir}/patch-api-visit-vet/curl-request.adoc[]

.Request
include::{restdocdir}/patch-api-visit-vet/http-request.adoc[]

.Response
include::{restdocdir}/patch-api-visit-vet/response-body.adoc[]

****

This operation reports `Ok` or code 200 if the entity was successfully updated.

This operation reports `Not Found` or code 404 if the entity does not exist.

This operation reports `Bad Request` or code 400 if the data was not processed.

This operation reports `Conflict` or code 409 if a unique constraint would be violated or if data is outdated (invalid ETag).

=== `GET /api/visit`

This operation returns all persisted _Visit_ entities.

This operation supports advanced query parameters for filtering, e.g.

`?date=2021-04-20`::
Find visits on a single date
`?date=2021-04-20&date=2021-04-25`::
Find visits between dates (inclusive)
`?date=2021-04-20&date=2021-04-22&date=2021-04-24`::
Find visits on multiple dates
`?pet.id=c1111111-1111-beef-dead-beefdeadbeef`::
Find visits for specific pet
`?pet.owner.id=b2222222-2222-beef-dead-beefdeadbeef`::
Find visits for pets owned by specific owner
`?vet.id=d1111111-1111-beef-dead-beefdeadbeef`::
Find visits with specific vet
`?text=Lorem`::
Find visits with text containing "Lorem" (case-insensitive)
`?text=Lorem%`::
Find visits with text starting with "Lorem" (case-insensitive)

This operation supports sorting, e.g.

`?sort=date,desc`::
Sort visits by date in descending order

This operation supports pagination, e.g.

`?size=10&page=1`::
Find 10 visits on page 1

****

.Command
include::{restdocdir}/get-api-visit/curl-request.adoc[]

.Request
include::{restdocdir}/get-api-visit/http-request.adoc[]

.Response
include::{restdocdir}/get-api-visit/response-body.adoc[]

****

This operation reports `Ok` or code 200 if the data was successfully loaded.

=== `GET /api/visit/{id}`

This operation returns a single persisted _Visit_ entity.

****

.Command
include::{restdocdir}/get-api-visit-by-id/curl-request.adoc[]

.Request
include::{restdocdir}/get-api-visit-by-id/http-request.adoc[]

.Response
include::{restdocdir}/get-api-visit-by-id/response-body.adoc[]

****

This operation reports `Ok` or code 200 if the data was successfully loaded.

This operation reports `Not Found` or code 404 if the entity does not exist.

=== `GET /api/visit/{id}/pet`

This operation returns the associated _Pet_ entity for a visit.

****

.Command
include::{restdocdir}/get-api-visit-pet/curl-request.adoc[]

.Request
include::{restdocdir}/get-api-visit-pet/http-request.adoc[]

.Response
include::{restdocdir}/get-api-visit-pet/response-body.adoc[]

****

This operation reports `Ok` or code 200 if the data was successfully loaded.

This operation reports `Not Found` or code 404 if the visit does not exist or has no pet.

=== `GET /api/visit/{id}/vet`

This operation returns the associated _Vet_ entity for a visit.

****

.Command
include::{restdocdir}/get-api-visit-vet/curl-request.adoc[]

.Request
include::{restdocdir}/get-api-visit-vet/http-request.adoc[]

.Response
include::{restdocdir}/get-api-visit-vet/response-body.adoc[]

****

This operation reports `Ok` or code 200 if the data was successfully loaded.

This operation reports `Not Found` or code 404 if the visit does not exist or has no vet.

=== `DELETE /api/visit/{id}`

This operation deletes a single persisted _Visit_ entity.

****

.Command
include::{restdocdir}/delete-api-visit/curl-request.adoc[]

.Request
include::{restdocdir}/delete-api-visit/http-request.adoc[]

.Response
include::{restdocdir}/delete-api-visit/response-body.adoc[]

****

This operation reports `Ok` or code 200 if the entity was successfully deleted.

This operation reports `Not Found` or code 404 if the entity does not exist.
